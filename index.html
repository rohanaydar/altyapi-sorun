<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diyarbakır Altyapı Bildirim Sistemi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }
        .logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .logo i { color: var(--light); }
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* TABS */
        .tabs {
            display: flex;
            background: white;
            border-bottom: 2px solid var(--light);
            margin: 0 auto;
            max-width: 800px;
        }
        .tab {
            flex: 1;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab:hover {
            background: #f8f9fa;
            color: var(--secondary);
        }
        .tab.active {
            color: var(--secondary);
            border-bottom-color: var(--secondary);
            background: #f8f9fa;
        }
        .tab i {
            margin-right: 8px;
        }
        
        /* CONTAINER */
        .container {
            max-width: 800px;
            margin: 30px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            overflow: hidden;
            display: none;
        }
        .container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* FORM */
        .form-container {
            padding: 40px;
        }
        .form-title {
            color: var(--primary);
            margin-bottom: 30px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .form-title i {
            color: var(--secondary);
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
        }
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
        }
        label i {
            margin-right: 8px;
            color: var(--secondary);
            width: 20px;
        }
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
            background: white;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        /* PRIORITY RADIO */
        .priority-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        .priority-option {
            flex: 1;
            text-align: center;
        }
        .priority-option input {
            display: none;
        }
        .priority-label {
            display: block;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        .priority-option input:checked + .priority-label {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
        }
        
        /* BUTTONS */
        .btn {
            padding: 16px 35px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary) 0%, #2980b9 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        }
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }
        .btn-success {
            background: var(--success);
            color: white;
        }
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .form-actions {
            text-align: center;
            margin-top: 40px;
        }
        
        /* SUCCESS MESSAGE */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
            display: none;
            border-left: 5px solid var(--success);
        }
        .success-message.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        .success-message h3 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        .tracking-code {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
            margin: 15px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            display: inline-block;
        }
        
        /* REPORTS TABLE */
        .reports-container {
            padding: 40px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-card h3 {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }
        .stat-card p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .reports-table {
            width: 100%;
            background: white;
            border-collapse: collapse;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .reports-table th {
            background: var(--primary);
            color: white;
            padding: 18px;
            text-align: left;
            font-weight: 600;
        }
        .reports-table td {
            padding: 18px;
            border-bottom: 1px solid #eee;
        }
        .reports-table tr:hover {
            background: #f8f9fa;
        }
        
        /* STATUS BADGES */
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        /* PRIORITY BADGES */
        .priority-badge {
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .priority-high {
            background: var(--danger);
            color: white;
        }
        .priority-medium {
            background: var(--warning);
            color: white;
        }
        .priority-low {
            background: var(--success);
            color: white;
        }
        
        /* FILTERS */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .filter-select {
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            font-size: 1rem;
            min-width: 200px;
        }
        
        /* FOOTER */
        .footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        .footer a {
            color: var(--secondary);
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        
        /* ADMIN PANEL */
        .admin-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .admin-stat {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: center;
        }
        .admin-stat h3 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-body {
            padding: 25px;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .container { margin: 15px; }
            .form-container, .reports-container { padding: 25px; }
            .form-grid { grid-template-columns: 1fr; }
            .filters { flex-direction: column; }
            .filter-select { width: 100%; }
            .reports-table { display: block; overflow-x: auto; }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <div class="logo">
            <i class="fas fa-city"></i>
        </div>
        <h1>Diyarbakır Altyapı Bildirim Sistemi</h1>
        <p>Mahallenizdeki altyapı sorunlarını bildirin, hızlı çözüm sağlayalım</p>
    </div>

    <!-- TABS -->
    <div class="tabs">
        <div class="tab active" data-tab="bildirim">
            <i class="fas fa-plus-circle"></i> Yeni Bildirim
        </div>
        <div class="tab" data-tab="bildirimler">
            <i class="fas fa-list"></i> Tüm Bildirimler
        </div>
        <div class="tab" data-tab="admin">
            <i class="fas fa-user-shield"></i> Admin Onay Paneli
        </div>
    </div>

    <!-- BILDIRIM FORM -->
    <div class="container active" id="bildirim-container">
        <div class="form-container">
            <h2 class="form-title">
                <i class="fas fa-bell"></i> Yeni Altyapı Bildirimi
            </h2>
            
            <form id="bildirimForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label><i class="fas fa-map-marker-alt"></i> İlçe</label>
                        <select id="ilce" required>
                            <option value="">Seçiniz</option>
                            <option value="Bağlar">Bağlar</option>
                            <option value="Kayapınar">Kayapınar</option>
                            <option value="Sur">Sur</option>
                            <option value="Yenişehir">Yenişehir</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-home"></i> Mahalle</label>
                        <select id="mahalle" required>
                            <option value="">Önce ilçe seçin</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-road"></i> Sokak / Cadde</label>
                    <input type="text" id="sokak" required placeholder="Örn: 293. Sokak, Atatürk Caddesi">
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label><i class="fas fa-exclamation-triangle"></i> Problem Tipi</label>
                        <select id="problemTipi" required>
                            <option value="">Seçiniz</option>
                            <option value="Yol Bozukluğu">Yol Bozukluğu</option>
                            <option value="Su Baskını">Su Baskını</option>
                            <option value="Kanalizasyon">Kanalizasyon Taşması</option>
                            <option value="Aydınlatma">Aydınlatma Arızası</option>
                            <option value="Çöp">Çöp Toplama Sorunu</option>
                            <option value="Park">Park/Bahçe Bakımı</option>
                            <option value="Diğer">Diğer</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-flag"></i> Öncelik Durumu</label>
                        <div class="priority-group">
                            <div class="priority-option">
                                <input type="radio" name="oncelik" value="low" id="low" checked>
                                <label class="priority-label" for="low">Düşük</label>
                            </div>
                            <div class="priority-option">
                                <input type="radio" name="oncelik" value="medium" id="medium">
                                <label class="priority-label" for="medium">Orta</label>
                            </div>
                            <div class="priority-option">
                                <input type="radio" name="oncelik" value="high" id="high">
                                <label class="priority-label" for="high">Acil</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-align-left"></i> Sorun Açıklaması</label>
                    <textarea id="aciklama" required placeholder="Sorunu detaylı bir şekilde açıklayın..."></textarea>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Adınız Soyadınız (İsteğe Bağlı)</label>
                        <input type="text" id="isim" placeholder="Adınız soyadınız">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-phone"></i> Telefon (İsteğe Bağlı)</label>
                        <input type="tel" id="telefon" placeholder="05xx xxx xx xx">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Bildirimi Gönder
                    </button>
                </div>
            </form>
            
            <div class="success-message" id="successMessage">
                <h3><i class="fas fa-check-circle"></i> Bildiriminiz Başarıyla Alındı!</h3>
                <p>Bildiriminiz sisteme kaydedildi ve incelenmek üzere yöneticilere iletildi.</p>
                <div class="tracking-code" id="trackingCode">DB-20240001</div>
                <p>Bu takip kodunu kaydedin, bildiriminizin durumunu takip etmek için kullanabilirsiniz.</p>
                <div style="margin-top: 25px;">
                    <button class="btn btn-secondary" onclick="showTab('bildirimler')">
                        <i class="fas fa-list"></i> Tüm Bildirimleri Gör
                    </button>
                    <button class="btn btn-primary" onclick="resetForm()">
                        <i class="fas fa-plus"></i> Yeni Bildirim
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- TÜM BILDIRIMLER -->
    <div class="container" id="bildirimler-container">
        <div class="reports-container">
            <h2 class="form-title">
                <i class="fas fa-list"></i> Tüm Bildirimler
            </h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalCount">0</h3>
                    <p>Toplam Bildirim</p>
                </div>
                <div class="stat-card">
                    <h3 id="pendingCount">0</h3>
                    <p>Bekleyen</p>
                </div>
                <div class="stat-card">
                    <h3 id="approvedCount">0</h3>
                    <p>Onaylanan</p>
                </div>
                <div class="stat-card">
                    <h3 id="completedCount">0</h3>
                    <p>Tamamlanan</p>
                </div>
            </div>
            
            <div class="filters">
                <select class="filter-select" id="statusFilter" onchange="filterReports()">
                    <option value="">Tüm Durumlar</option>
                    <option value="pending">Bekleyen</option>
                    <option value="approved">Onaylanan</option>
                    <option value="rejected">Reddedilen</option>
                    <option value="completed">Tamamlanan</option>
                </select>
                
                <select class="filter-select" id="ilceFilter" onchange="filterReports()">
                    <option value="">Tüm İlçeler</option>
                    <option value="Bağlar">Bağlar</option>
                    <option value="Kayapınar">Kayapınar</option>
                    <option value="Sur">Sur</option>
                    <option value="Yenişehir">Yenişehir</option>
                </select>
                
                <select class="filter-select" id="priorityFilter" onchange="filterReports()">
                    <option value="">Tüm Öncelikler</option>
                    <option value="high">Acil</option>
                    <option value="medium">Orta</option>
                    <option value="low">Düşük</option>
                </select>
            </div>
            
            <table class="reports-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tarih</th>
                        <th>Mahalle</th>
                        <th>Problem</th>
                        <th>Öncelik</th>
                        <th>Durum</th>
                        <th>İşlem</th>
                    </tr>
                </thead>
                <tbody id="reportsTableBody">
                    <!-- Reports will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- ADMIN PANEL -->
    <div class="container" id="admin-container">
        <div class="admin-header">
            <h2><i class="fas fa-user-shield"></i> Admin Onay Paneli</h2>
            <p>Bildirimleri onaylayın, reddedin veya durumlarını güncelleyin</p>
        </div>
        
        <div class="reports-container">
            <div class="admin-stats">
                <div class="admin-stat">
                    <h3 id="adminTotal">0</h3>
                    <p>Toplam Bildirim</p>
                </div>
                <div class="admin-stat">
                    <h3 id="adminPending">0</h3>
                    <p>Onay Bekleyen</p>
                </div>
                <div class="admin-stat">
                    <h3 id="adminToday">0</h3>
                    <p>Bugünkü Bildirim</p>
                </div>
                <div class="admin-stat">
                    <h3 id="adminResolved">0</h3>
                    <p>Çözülen</p>
                </div>
            </div>
            
            <div class="filters">
                <select class="filter-select" id="adminStatusFilter" onchange="loadAdminReports()">
                    <option value="">Tüm Durumlar</option>
                    <option value="pending">Sadece Bekleyen</option>
                    <option value="approved">Onaylananlar</option>
                    <option value="rejected">Reddedilenler</option>
                </select>
                
                <button class="btn btn-primary" onclick="refreshAdminData()">
                    <i class="fas fa-sync-alt"></i> Yenile
                </button>
            </div>
            
            <table class="reports-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tarih</th>
                        <th>Mahalle</th>
                        <th>Sokak</th>
                        <th>Problem</th>
                        <th>Öncelik</th>
                        <th>Durum</th>
                        <th>İşlem</th>
                    </tr>
                </thead>
                <tbody id="adminTableBody">
                    <!-- Admin reports will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- MODAL FOR REPORT DETAILS -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Bildirim Detayları</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        <p>© 2024 Diyarbakır Altyapı Bildirim Sistemi. Tüm hakları saklıdır.</p>
        <p>Telefon: <a href="tel:04121234567">0412 123 45 67</a> | Email: <a href="mailto:altyapi@diyarbakir.bel.tr">altyapi@diyarbakir.bel.tr</a></p>
    </div>

    <script src="database.js"></script>
    <script>
        // İlçe-Mahalle eşleştirmesi
        const mahalleler = {
            'Bağlar': ['Kaynartepe', 'Yeniköy', 'Fırat', 'Barış', '5 Nisan', 'Aşağıışıklar'],
            'Kayapınar': ['Karacadağ', 'Cumhuriyet', 'Yenimahalle', 'Huzurevleri', 'Üçkuyu'],
            'Sur': ['Alipaşa', 'Cevatpaşa', 'Hasırlı', 'Melikahmet', 'Süleymannazif'],
            'Yenişehir': ['Aziziye', 'Karşıyaka', 'Ofis', 'Selahattineyyubi', 'Şehitlik']
        };

        // Tab değiştirme
        function showTab(tabName) {
            // Tüm tabları ve container'ları gizle
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.container').forEach(container => container.classList.remove('active'));
            
            // Seçili tabı ve container'ı göster
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-container`).classList.add('active');
            
            // Verileri yükle
            if (tabName === 'bildirimler') {
                loadReports();
            } else if (tabName === 'admin') {
                loadAdminReports();
            }
        }

        // İlçe seçildiğinde mahalleleri yükle
        document.getElementById('ilce').addEventListener('change', function() {
            const ilce = this.value;
            const mahalleSelect = document.getElementById('mahalle');
            mahalleSelect.innerHTML = '<option value="">Seçiniz</option>';
            
            if (ilce && mahalleler[ilce]) {
                mahalleler[ilce].forEach(mahalle => {
                    const option = document.createElement('option');
                    option.value = mahalle;
                    option.textContent = mahalle;
                    mahalleSelect.appendChild(option);
                });
            }
        });

        // Tab click event'leri
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                showTab(this.dataset.tab);
            });
        });

        // Form submit
        document.getElementById('bildirimForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Bildirim oluştur
            const bildirim = {
                id: 'DB-' + Date.now().toString().slice(-8),
                ilce: document.getElementById('ilce').value,
                mahalle: document.getElementById('mahalle').value,
                sokak: document.getElementById('sokak').value,
                problemTipi: document.getElementById('problemTipi').value,
                oncelik: document.querySelector('input[name="oncelik"]:checked').value,
                aciklama: document.getElementById('aciklama').value,
                isim: document.getElementById('isim').value || 'İsimsiz',
                telefon: document.getElementById('telefon').value || 'Belirtilmemiş',
                tarih: new Date().toLocaleString('tr-TR'),
                durum: 'pending', // Beklemede
                adminNot: ''
            };
            
            // Database'e kaydet
            const saved = window.database.saveReport(bildirim);
            
            if (saved) {
                // Takip kodunu göster
                document.getElementById('trackingCode').textContent = bildirim.id;
                
                // Başarı mesajını göster
                document.getElementById('successMessage').classList.add('active');
                document.getElementById('bildirimForm').style.display = 'none';
                
                // İstatistikleri güncelle
                updateStats();
            }
        });

        // Formu sıfırla
        function resetForm() {
            document.getElementById('bildirimForm').reset();
            document.getElementById('mahalle').innerHTML = '<option value="">Önce ilçe seçin</option>';
            document.getElementById('successMessage').classList.remove('active');
            document.getElementById('bildirimForm').style.display = 'block';
        }

        // Raporları yükle
        function loadReports() {
            const reports = window.database.getAllReports();
            const filteredReports = filterReportsData(reports);
            
            // İstatistikleri güncelle
            updateStats();
            
            // Tabloyu doldur
            const tbody = document.getElementById('reportsTableBody');
            tbody.innerHTML = '';
            
            filteredReports.forEach(report => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${report.id}</td>
                    <td>${report.tarih}</td>
                    <td>${report.mahalle}</td>
                    <td>${report.problemTipi}</td>
                    <td><span class="priority-badge priority-${report.oncelik}">${
                        report.oncelik === 'high' ? 'Acil' : 
                        report.oncelik === 'medium' ? 'Orta' : 'Düşük'
                    }</span></td>
                    <td><span class="status-badge status-${report.durum}">${
                        report.durum === 'pending' ? 'Bekliyor' :
                        report.durum === 'approved' ? 'Onaylandı' :
                        report.durum === 'rejected' ? 'Reddedildi' : 'Tamamlandı'
                    }</span></td>
                    <td>
                        <button class="btn btn-small btn-secondary" onclick="viewReport('${report.id}')">
                            <i class="fas fa-eye"></i> Detay
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            if (filteredReports.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                            Henüz bildirim bulunmuyor
                        </td>
                    </tr>
                `;
            }
        }

        // Admin raporlarını yükle
        function loadAdminReports() {
            const reports = window.database.getAllReports();
            const statusFilter = document.getElementById('adminStatusFilter').value;
            
            let filteredReports = reports;
            if (statusFilter) {
                filteredReports = reports.filter(r => r.durum === statusFilter);
            }
            
            // Admin istatistiklerini güncelle
            updateAdminStats(reports);
            
            // Tabloyu doldur
            const tbody = document.getElementById('adminTableBody');
            tbody.innerHTML = '';
            
            filteredReports.forEach(report => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${report.id}</td>
                    <td>${report.tarih}</td>
                    <td>${report.mahalle}</td>
                    <td>${report.sokak}</td>
                    <td>${report.problemTipi}</td>
                    <td><span class="priority-badge priority-${report.oncelik}">${
                        report.oncelik === 'high' ? 'Acil' : 
                        report.oncelik === 'medium' ? 'Orta' : 'Düşük'
                    }</span></td>
                    <td><span class="status-badge status-${report.durum}">${
                        report.durum === 'pending' ? 'Bekliyor' :
                        report.durum === 'approved' ? 'Onaylandı' :
                        report.durum === 'rejected' ? 'Reddedildi' : 'Tamamlandı'
                    }</span></td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-small btn-success" onclick="approveReport('${report.id}')" ${report.durum === 'approved' ? 'disabled' : ''}>
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-small btn-danger" onclick="rejectReport('${report.id}')" ${report.durum === 'rejected' ? 'disabled' : ''}>
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="btn btn-small btn-warning" onclick="completeReport('${report.id}')" ${report.durum === 'completed' ? 'disabled' : ''}>
                                <i class="fas fa-flag-checkered"></i>
                            </button>
                            <button class="btn btn-small btn-secondary" onclick="viewReport('${report.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Rapor filtreleme
        function filterReports() {
            loadReports();
        }

        // Filtreleme fonksiyonu
        function filterReportsData(reports) {
            const statusFilter = document.getElementById('statusFilter').value;
            const ilceFilter = document.getElementById('ilceFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            
            return reports.filter(report => {
                if (statusFilter && report.durum !== statusFilter) return false;
                if (ilceFilter && report.ilce !== ilceFilter) return false;
                if (priorityFilter && report.oncelik !== priorityFilter) return false;
                return true;
            });
        }

        // İstatistikleri güncelle
        function updateStats() {
            const reports = window.database.getAllReports();
            
            document.getElementById('totalCount').textContent = reports.length;
            document.getElementById('pendingCount').textContent = reports.filter(r => r.durum === 'pending').length;
            document.getElementById('approvedCount').textContent = reports.filter(r => r.durum === 'approved').length;
            document.getElementById('completedCount').textContent = reports.filter(r => r.durum === 'completed').length;
        }

        // Admin istatistiklerini güncelle
        function updateAdminStats(reports) {
            const today = new Date().toLocaleDateString('tr-TR');
            const todayReports = reports.filter(r => r.tarih.includes(today.split(' ')[0]));
            
            document.getElementById('adminTotal').textContent = reports.length;
            document.getElementById('adminPending').textContent = reports.filter(r => r.durum === 'pending').length;
            document.getElementById('adminToday').textContent = todayReports.length;
            document.getElementById('adminResolved').textContent = reports.filter(r => r.durum === 'completed').length;
        }

        // Admin işlemleri
        function approveReport(id) {
            if (confirm('Bu bildirimi onaylamak istediğinize emin misiniz?')) {
                window.database.updateReportStatus(id, 'approved', 'Admin tarafından onaylandı');
                loadAdminReports();
                loadReports();
                alert('Bildirim onaylandı!');
            }
        }

        function rejectReport(id) {
            const reason = prompt('Reddetme sebebini yazın:');
            if (reason) {
                window.database.updateReportStatus(id, 'rejected', `Reddedildi: ${reason}`);
                loadAdminReports();
                loadReports();
                alert('Bildirim reddedildi!');
            }
        }

        function completeReport(id) {
            if (confirm('Bu bildirimi tamamlandı olarak işaretlemek istediğinize emin misiniz?')) {
                window.database.updateReportStatus(id, 'completed', 'Tamamlandı');
                loadAdminReports();
                loadReports();
                alert('Bildirim tamamlandı olarak işaretlendi!');
            }
        }

        // Rapor detaylarını göster
        function viewReport(id) {
            const report = window.database.getReport(id);
            if (report) {
                document.getElementById('modalBody').innerHTML = `
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Bildirim Bilgileri</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <strong>ID:</strong> ${report.id}
                            </div>
                            <div>
                                <strong>Tarih:</strong> ${report.tarih}
                            </div>
                            <div>
                                <strong>İlçe:</strong> ${report.ilce}
                            </div>
                            <div>
                                <strong>Mahalle:</strong> ${report.mahalle}
                            </div>
                            <div>
                                <strong>Sokak:</strong> ${report.sokak}
                            </div>
                            <div>
                                <strong>Problem:</strong> ${report.problemTipi}
                            </div>
                            <div>
                                <strong>Öncelik:</strong> <span class="priority-badge priority-${report.oncelik}">${
                                    report.oncelik === 'high' ? 'Acil' : 
                                    report.oncelik === 'medium' ? 'Orta' : 'Düşük'
                                }</span>
                            </div>
                            <div>
                                <strong>Durum:</strong> <span class="status-badge status-${report.durum}">${
                                    report.durum === 'pending' ? 'Bekliyor' :
                                    report.durum === 'approved' ? 'Onaylandı' :
                                    report.durum === 'rejected' ? 'Reddedildi' : 'Tamamlandı'
                                }</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Açıklama</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                            ${report.aciklama}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Bildiren Kişi</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <strong>Ad Soyad:</strong> ${report.isim}
                            </div>
                            <div>
                                <strong>Telefon:</strong> ${report.telefon}
                            </div>
                        </div>
                    </div>
                    
                    ${report.adminNot ? `
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Admin Notu</h4>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                            ${report.adminNot}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
                        <button class="btn btn-secondary" onclick="closeModal()">
                            <i class="fas fa-times"></i> Kapat
                        </button>
                        ${report.durum === 'pending' ? `
                        <button class="btn btn-success" onclick="approveReport('${report.id}'); closeModal();">
                            <i class="fas fa-check"></i> Onayla
                        </button>
                        <button class="btn btn-danger" onclick="rejectReport('${report.id}'); closeModal();">
                            <i class="fas fa-times"></i> Reddet
                        </button>
                        ` : ''}
                        ${report.durum === 'approved' ? `
                        <button class="btn btn-warning" onclick="completeReport('${report.id}'); closeModal();">
                            <i class="fas fa-flag-checkered"></i> Tamamlandı
                        </button>
                        ` : ''}
                    </div>
                `;
                
                document.getElementById('reportModal').classList.add('active');
            }
        }

        // Modal'ı kapat
        function closeModal() {
            document.getElementById('reportModal').classList.remove('active');
        }

        // Admin verilerini yenile
        function refreshAdminData() {
            loadAdminReports();
            alert('Veriler yenilendi!');
        }

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            // İstatistikleri yükle
            updateStats();
            
            // Sayfa yüklendiğinde bildirimler sekmesini yükle
            if (window.location.hash === '#bildirimler') {
                showTab('bildirimler');
            } else if (window.location.hash === '#admin') {
                showTab('admin');
            }
        });

        // Enter tuşu ile form gönderimi
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
